<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/smirik/resonances/libration/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Libration module - Mean-Motion Resonances</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Libration module";
        var mkdocs_page_input_path = "libration.md";
        var mkdocs_page_url = "/smirik/resonances/libration/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Mean-Motion Resonances
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../quick-start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">Installation and updates</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../core/">Simulations and Bodies</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Libration module</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#metrics">Metrics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-workflow-of-identification">The workflow of identification</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#possible-statuses">Possible statuses</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#a-few-comments-to-the-negative-statuses">A few comments to the negative statuses</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#periodograms">Periodograms</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-workflow">The workflow</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-usage">The usage</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../matrix/">Resonance Matrices</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config/">Config</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../console/">Console commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../about/">Copyright, license, references</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Mean-Motion Resonances</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Features &raquo;</li>
      <li>Libration module</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/smirik/resonances/blob/master/docs/libration.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="libration">Libration</h1>
<p>There is no obvious algorithm how to identify whether or not the asteroid is in the resonance. While there are simple cases (such as 463 Lola in <code>4J-2S-1</code>, see <a href="../quick-start/">Example</a>), there are many asteroids whose resonant angles are librating but not the whole time. Moreover, it might be the case that the resonant angle librates, but the frequency of these oscillations differs from the frequency of the librations of the values of the semi-major axis. Therefore, a complex solution is needed.</p>
<h2 id="metrics">Metrics</h2>
<p>The module <code>resonances.libration</code> uses several metrics to resolve whether or not an asteroid is resonant:</p>
<ol>
<li><code>pure</code>: this flag shows is there at least one period of circulation. Technically, it means that the resonant angle (limited by 2&pi; filter) should never break the limits of <code>0</code> and <code>2&amp;pi</code> or be shifted by a constant.</li>
<li><code>overlapping</code>: the module calculates the frequencies of oscillations of the resonant angle and semi-major axis (see <a href="../config/">Config</a> for the limits used by default). If there is a shared frequency within limits, then it signals that there might be a resonance.</li>
<li><code>max_libration_length</code>: it represents the longest period of libration of the resonant angle. Or, in other words, how long there was no intersection of the borders (0 and 2&pi;). For all resonant asteroids, this value should be high enough.</li>
<li><code>monotony</code>: a very simple metric that calculates the percentage of the points when the value of the resonant angle for the current time is less than the same value for the previous step. If the resonant angle librates, it means that this value should be close to <code>0.5</code>.</li>
</ol>
<p>All these values are available for <code>Body</code> objects after the integration. They are available in the output file <code>summary.csv</code>. The time series (if the appropriate flag is set) are also stored in CSV files in the output directory.</p>
<p>You may invoke or recalculate them in the following way:</p>
<pre><code class="language-python">sim = resonances.Simulation()
# ...
body = sim.bodies[0]
body.librations
body.libration_metrics
body.libration_pure
body.periodogram_frequency
body.periodogram_power
body.periodogram_peaks
body.axis_filtered
body.axis_periodogram_frequency
body.axis_periodogram_power
body.axis_periodogram_peaks
</code></pre>
<p>For the detailed algorithm, see <code>resonances/resonance/libration.py</code> file.</p>
<h2 id="the-workflow-of-identification">The workflow of identification</h2>
<p>How the app distinguishes different types of asteroids?</p>
<ol>
<li>If there is a pure libration around 0 or &pi; <strong>and</strong> the frequency of libration (based on <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.lombscargle.html">the Lomb-Scargle periodogram</a>) is close to the frequency of oscillations of semi-major axis (more precisely: if the peaks taken with their width overlap each other), then the function ends with the status <code>2</code>.</li>
<li>If there is no shared frequency for the oscillations of the resonant angle and the semi-major axis, but the libration is pure, then the app considers this case <em>difficult</em> and set the status <code>-2</code>, which means that manual verification is needed.</li>
<li>If there is a shared frequency of oscillations and the libration period is <em>long enough</em> (set in <a href="../config/">Config</a>), then the function ends with the status <code>1</code>, which means that the asteroid is in a transient resonance.</li>
<li>However, if there is no shared frequency but still the libration period is <em>long enough</em>, the app checks the monotony metrics. If it is acceptable, then the function ends with the status <code>-1</code>, which means that there is something strange and thus should be verified manually.</li>
<li>For all other cases, the function ends with the status <code>0</code>, which means that the asteroid is not in the resonance.</li>
</ol>
<h2 id="possible-statuses">Possible statuses</h2>
<table>
<thead>
<tr>
<th align="center">Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">2</td>
<td>There is a pure libration around 0 or Pi.</td>
</tr>
<tr>
<td align="center">1</td>
<td>There is a libration, but it does not look pure.</td>
</tr>
<tr>
<td align="center">0</td>
<td>There is no libration (circulation or similar).</td>
</tr>
<tr>
<td align="center">-1</td>
<td>Requires manual verification (transient libration).</td>
</tr>
<tr>
<td align="center">-2</td>
<td>Requires manual verification (pure libration).</td>
</tr>
</tbody>
</table>
<h3 id="a-few-comments-to-the-negative-statuses">A few comments to the negative statuses</h3>
<ol>
<li><code>-1</code>: It looks like that there is no libration because there is no shared frequency of oscillation between resonant angle and semi-major axis. However, the behaviour of the resonant angle is not chaotic and thus needs to be manually verified.</li>
<li><code>-2</code>: There is a pure libration of the resonant angle. However, the frequency of oscillations does not correspond to the frequency of the oscillations of the semi-major axis. Thus, it requires manual verification.</li>
</ol>
<h2 id="periodograms">Periodograms</h2>
<h3 id="the-workflow">The workflow</h3>
<p>The app builds periodograms for the resonant angle and semi-major axis of an object. If an asteroid is resonant, the frequencies of oscillations of these variables should match.</p>
<p>However, both resonant angle and semi-major axis have a lot of short-term librations. Thus, they should be filtered to avoid false positives. The app filters the data before building periodograms.</p>
<p>To filter the data, the app uses <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.butter.html">scipy.signal.butter</a> low-pass digital filter. The critical frequency is equal to the ratio of the cutoff variable and the Nyquist frequency. You can set the desired value of the cutoff in the config <code>libration.oscillation.filter.cutoff</code>; the default value is <code>0.0005</code>, which corresponds to the period of <code>2000</code> yrs. Hence, the filter will cut off everything below this value (or above in terms of frequencies). The config value <code>libration.oscillation.filter.order</code> sets up the default order of the filter.</p>
<p>The Nyquist frequency is set as half of the sampling frequency, which is the ratio between the number of points to output (<code>integration.Nout</code>; by default, 1/100 of <code>integration.tmax</code>) and the integration time in years (<code>integration.tmax</code> divided by 2&pi; <code>100,000</code> by default).</p>
<p>The filtering procedure uses <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.filtfilt.html">scipy.signal.filtfilt</a> for the filter designed by scipy.signal.butter. The default method is Gustafsson’s one.</p>
<p>Another complication appears after applying the filter: the values of the first and the last points (in time) might be 'damaged' because the filter smooths the data based on the historical values, which are not presented for the beginning and the end. Thus, it is a good idea to cut some points off to improve the accuracy of the identification of oscillations frequencies.</p>
<p>To calculate the number of points to cut, the app uses the parameter <code>libration.period.min</code> (by default, <code>500</code>), which represents the number of years to remove from the beginning and end. To adjust it to other parameters, it is multiplied by the sampling frequency. Hence, there are no very low frequencies in the resulting data. If you do not want to cut these points, just set the parameter to <code>0</code>.</p>
<h3 id="the-usage">The usage</h3>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../core/" class="btn btn-neutral float-left" title="Simulations and Bodies"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../matrix/" class="btn btn-neutral float-right" title="Resonance Matrices">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/smirik/resonances" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../core/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../matrix/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
